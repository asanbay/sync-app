<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>üìö –°–∏—Å—Ç–µ–º–∞ –£—á—ë—Ç–∞ –ò–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–µ–π - ENHANCED</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        :root {
            --primary: #2b79b8;
            --primary-dark: #1e5c96;
            --success: #10b981;
            --success-dark: #059669;
            --danger: #ef4444;
            --danger-dark: #dc2626;
            --warning: #f59e0b;
            --warning-dark: #d97706;
            --info: #3b82f6;
            --bg-primary: #071023;
            --bg-secondary: #0b1220;
            --bg-card: #0c1724;
            --bg-hover: rgba(96, 165, 250, 0.1);
            --text-primary: #e6eef8;
            --text-secondary: #9fbffd;
            --border: #333;
            --accent: #60a5fa;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            padding: 20px;
        }
        
        .container { max-width: 1800px; margin: 0 auto; }
        
        header {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        .header-left { display: flex; align-items: center; gap: 15px; }
        .header-right { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        
        h1 { 
            font-size: 26px; 
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .user-badge {
            background: linear-gradient(135deg, var(--primary), var(--info));
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .controls { display: flex; gap: 10px; flex-wrap: wrap; }
        
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: var(--bg-card);
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .tab-btn {
            background: transparent;
            border: none;
            padding: 12px 20px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .tab-btn:hover { 
            background: var(--bg-hover);
            color: var(--accent);
            transform: translateY(-2px);
        }
        
        .tab-btn.active { 
            background: linear-gradient(135deg, var(--primary), var(--info));
            color: white;
            box-shadow: 0 4px 8px rgba(43, 121, 184, 0.3);
        }
        
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--accent);
        }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .btn:hover { 
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .btn:active { transform: translateY(0); }
        
        .btn-success { background: var(--success); }
        .btn-success:hover { background: var(--success-dark); }
        .btn-danger { background: var(--danger); }
        .btn-danger:hover { background: var(--danger-dark); }
        .btn-warning { background: var(--warning); }
        .btn-warning:hover { background: var(--warning-dark); }
        .btn-info { background: var(--info); }
        .btn-info:hover { background: #2563eb; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        
        select, input, textarea {
            background: rgba(12, 23, 36, 0.8);
            color: var(--text-primary);
            border: 1px solid var(--border);
            padding: 10px;
            border-radius: 8px;
            font-size: 13px;
            transition: all 0.3s;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin-top: 15px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        th { 
            background: #1a2a3a;
            font-weight: 600;
        }
        
        tr { transition: all 0.2s; }
        tr:hover { background: var(--bg-hover); }
        
        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .badge-done { 
            background: rgba(16, 185, 129, 0.2); 
            color: #86efac;
            border: 1px solid rgba(134, 239, 172, 0.3);
        }
        .badge-started { 
            background: rgba(59, 130, 246, 0.2); 
            color: #93c5fd;
            border: 1px solid rgba(147, 197, 253, 0.3);
        }
        .badge-pending { 
            background: rgba(245, 158, 11, 0.2); 
            color: #fcd34d;
            border: 1px solid rgba(252, 211, 77, 0.3);
        }
        
        .btn.badge-done:hover { background: rgba(16, 185, 129, 0.4); }
        .btn.badge-started:hover { background: rgba(59, 130, 246, 0.4); }
        .btn.badge-pending:hover { background: rgba(245, 158, 11, 0.4); }
        
        .modal {
            display: none;
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show { display: flex; }
        
        .modal-content {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            border: 1px solid var(--border);
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .modal-content h2 { margin-bottom: 20px; color: var(--accent); }
        
        .form-group { margin-bottom: 15px; }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 13px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat {
            background: linear-gradient(135deg, rgba(43, 121, 184, 0.1), rgba(59, 130, 246, 0.1));
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border-left: 4px solid var(--accent);
            transition: all 0.3s;
        }
        
        .stat:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }
        
        .stat-value { 
            font-size: 32px; 
            font-weight: bold;
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-label { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px;
            font-weight: 500;
        }
        
        .stat-icon {
            font-size: 24px;
            opacity: 0.3;
            margin-bottom: 10px;
        }
        
        .chart-container {
            position: relative;
            height: 350px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(12, 23, 36, 0.5);
            border-radius: 12px;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .filter-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-label {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 13px;
        }
        
        .history-day {
            background: rgba(51, 65, 85, 0.3);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 12px;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .history-day:hover { border-color: var(--accent); }
        
        .history-day-header {
            padding: 12px;
            background: rgba(96, 165, 250, 0.1);
            cursor: pointer;
            font-weight: 600;
            color: var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-day-content {
            display: none;
            padding: 12px;
        }
        
        .history-day-content.show { display: block; }
        
        .history-item {
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(51, 65, 85, 0.2);
            border-left: 3px solid var(--accent);
            border-radius: 6px;
            font-size: 12px;
        }
        
        h3 { 
            margin-top: 25px; 
            margin-bottom: 15px;
            color: var(--accent);
            font-size: 18px;
        }
        
        .category-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .category-item input { flex: 1; }
        
        .kpi-card {
            background: linear-gradient(135deg, rgba(43, 121, 184, 0.2), rgba(59, 130, 246, 0.2));
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--accent);
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .kpi-item {
            text-align: center;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }
        
        .kpi-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--accent);
        }
        
        .kpi-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(51, 65, 85, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--info));
            transition: width 0.5s;
        }
        
        .settings-section {
            background: #0f1724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 3px solid var(--accent);
        }
        
        .settings-section h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--accent);
        }
        
        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .chart-grid { grid-template-columns: 1fr; }
            h1 { font-size: 20px; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="header-left">
            <h1>üìö –°–∏—Å—Ç–µ–º–∞ –£—á—ë—Ç–∞ –ò–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–µ–π</h1>
            <div class="user-badge" id="userDisplay">üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
        </div>
        <div class="header-right">
            <button class="btn btn-success" onclick="showModal('addTaskModal')">
                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å
            </button>
            <button class="btn btn-warning" onclick="doExport()">
                <i class="fas fa-file-excel"></i> Excel
            </button>
            <button class="btn btn-info" onclick="doExportJSON()">
                <i class="fas fa-file-code"></i> JSON
            </button>
            <select onchange="changeUser()" id="userSelect">
                <option value="asanbek">–ê—Å–∞–Ω–±–µ–∫</option>
                <option value="akylbek">–ê–∫—ã–ª–±–µ–∫</option>
            </select>
        </div>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'tasks')">üìã –ó–∞–¥–∞—á–∏</button>
        <button class="tab-btn" onclick="openTab(event, 'dashboard')"><i class="fas fa-chart-line"></i> –î–∞—à–±–æ—Ä–¥</button>
        <button class="tab-btn" onclick="openTab(event, 'analytics')">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
        <button class="tab-btn" onclick="openTab(event, 'testing')">‚úì –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
        <button class="tab-btn" onclick="openTab(event, 'history')">üïê –ò—Å—Ç–æ—Ä–∏—è</button>
        <button class="tab-btn" onclick="openTab(event, 'settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    </div>

    <!-- –ó–ê–î–ê–ß–ò -->
    <div id="tasks" class="tab-content active">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">–ó–∞–¥–∞—á–∏</h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <small style="color: var(--text-secondary); font-size: 11px;">
                        üí° –°–æ–≤–µ—Ç: –í—Ä–µ–º—è –≤–≤–æ–¥–∏—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ß–ß:–ú–ú (–Ω–∞–ø—Ä–∏–º–µ—Ä: 2:30)
                    </small>
                </div>
            </div>

            <div class="filter-group">
                <select id="filterCategory" onchange="showTasks()" style="max-width: 200px;">
                    <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                </select>
                <select id="filterStatus" onchange="showTasks()" style="max-width: 200px;">
                    <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    <option value="–û–∂–∏–¥–∞–Ω–∏–µ">–û–∂–∏–¥–∞–Ω–∏–µ</option>
                    <option value="–ù–∞—á–∞—Ç–æ">–ù–∞—á–∞—Ç–æ</option>
                    <option value="–í—ã–ø–æ–ª–Ω–µ–Ω–æ">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
                </select>
            </div>

            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th>–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</th>
                            <th>–í—Ä–µ–º—è (–ß–ß:–ú–ú)</th>
                            <th style="min-width: 180px;">–°—Ç–∞—Ç—É—Å / –î–µ–π—Å—Ç–≤–∏—è</th>
                            <th>üóëÔ∏è</th>
                        </tr>
                    </thead>
                    <tbody id="tasksTable">
                        <tr><td colspan="8">–ù–µ—Ç –∑–∞–¥–∞—á</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- –î–ê–®–ë–û–†–î -->
    <div id="dashboard" class="tab-content">
        <div class="kpi-card">
            <h2>üìä KPI –ü–∞–Ω–µ–ª—å</h2>
            <div class="kpi-grid" id="kpiGrid"></div>
        </div>

        <div class="stats-grid">
            <div class="stat">
                <div class="stat-icon">üìö</div>
                <div class="stat-value" id="totalTasks">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–µ–π</div>
            </div>
            <div class="stat">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-value" id="completedTasks">0</div>
                <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
            </div>
            <div class="stat">
                <div class="stat-icon">‚è≥</div>
                <div class="stat-value" id="inProgressTasks">0</div>
                <div class="stat-label">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</div>
            </div>
            <div class="stat">
                <div class="stat-icon">‚è±Ô∏è</div>
                <div class="stat-value" id="totalHours">0</div>
                <div class="stat-label">–ß–∞—Å–æ–≤ –æ–±—É—á–µ–Ω–∏—è</div>
            </div>
            <div class="stat">
                <div class="stat-icon">üë§</div>
                <div class="stat-value" id="statAsanbek">0</div>
                <div class="stat-label">–ê—Å–∞–Ω–±–µ–∫</div>
            </div>
            <div class="stat">
                <div class="stat-icon">üë§</div>
                <div class="stat-value" id="statAkylbek">0</div>
                <div class="stat-label">–ê–∫—ã–ª–±–µ–∫</div>
            </div>
        </div>

        <div class="chart-grid">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üìà –ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
                </div>
                <div class="chart-container">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üéØ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
                </div>
                <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üìä –¢–µ–Ω–¥–µ–Ω—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞ –Ω–µ–¥–µ–ª—é</h3>
            </div>
            <div class="chart-container">
                <canvas id="weeklyTrendChart"></canvas>
            </div>
        </div>
    </div>

    <!-- –ê–ù–ê–õ–ò–¢–ò–ö–ê -->
    <div id="analytics" class="tab-content">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">üìä –î–µ—Ç–∞–ª—å–Ω–∞—è –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
                <div class="controls">
                    <button class="btn btn-sm" onclick="showAnalytics('weekly')">–ó–∞ –Ω–µ–¥–µ–ª—é</button>
                    <button class="btn btn-sm" onclick="showAnalytics('monthly')">–ó–∞ –º–µ—Å—è—Ü</button>
                </div>
            </div>
            <div id="analyticsContent"></div>
        </div>

        <div class="chart-grid">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üë• –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤</h3>
                </div>
                <div class="chart-container">
                    <canvas id="instructorChart"></canvas>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üî• –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –º–µ—Å—è—Ü–∞–º</h3>
                </div>
                <div class="chart-container">
                    <canvas id="heatmapChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üìà –ü—Ä–æ–≥–Ω–æ–∑–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
            </div>
            <div class="chart-container">
                <canvas id="forecastChart"></canvas>
            </div>
        </div>
    </div>

    <!-- –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï -->
    <div id="testing" class="tab-content">
        <div class="card">
            <h2>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
            
            <div class="filter-group">
                <button class="btn btn-sm" onclick="showModal('eIsotModal')">–ï–ò–°–û–¢</button>
                <button class="btn btn-warning btn-sm" onclick="showModal('prombezModal')">–ü—Ä–æ–º–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</button>
                <button class="btn btn-success btn-sm" onclick="showModal('ndTestingModal')">–ù–î —Ç–µ—Å—Ç—ã</button>
            </div>

            <h3>–ò—Å—Ç–æ—Ä–∏—è –ï–ò–°–û–¢</h3>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞</th>
                            <th>–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</th>
                            <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                            <th>–í—Ä–µ–º—è (–º–∏–Ω)</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="eIsotTable"></tbody>
                </table>
            </div>

            <h3>–ò—Å—Ç–æ—Ä–∏—è –ü—Ä–æ–º–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞</th>
                            <th>–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</th>
                            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="prombezTable"></tbody>
                </table>
            </div>

            <h3>–ò—Å—Ç–æ—Ä–∏—è –ù–î —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞</th>
                            <th>–¢–∏–ø</th>
                            <th>–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</th>
                            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="ndTestingTable"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- –ò–°–¢–û–†–ò–Ø -->
    <div id="history" class="tab-content">
        <div class="card">
            <h2>–ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π</h2>
            
            <div class="filter-group">
                <select id="historyFilter" onchange="renderHistory()" style="max-width: 200px;">
                    <option value="">–í—Å–µ</option>
                    <option value="asanbek">–ê—Å–∞–Ω–±–µ–∫</option>
                    <option value="akylbek">–ê–∫—ã–ª–±–µ–∫</option>
                </select>
            </div>

            <div id="historyContainer"></div>
        </div>
    </div>

    <!-- –ù–ê–°–¢–†–û–ô–ö–ò -->
    <div id="settings" class="tab-content">
        <div class="card">
            <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>

            <!-- –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –° GOOGLE SHEETS -->
            <div class="settings-section">
                <h4>‚òÅÔ∏è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Google Sheets</h4>
                
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-success" onclick="syncToCloud()">
                        <i class="fas fa-cloud-upload-alt"></i> ‚òÅÔ∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ –æ–±–ª–∞–∫–æ
                    </button>
                    <button class="btn btn-warning" onclick="syncFromCloud()">
                        <i class="fas fa-cloud-download-alt"></i> ‚òÅÔ∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –æ–±–ª–∞–∫–∞
                    </button>
                </div>
                
                <div style="margin-top: 10px; padding: 10px; background: rgba(96, 165, 250, 0.1); border-radius: 6px;">
                    <small style="color: var(--text-secondary);">
                        üí° <strong>–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong><br>
                        ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ –æ–±–ª–∞–∫–æ" - —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ Google Sheets<br>
                        ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –æ–±–ª–∞–∫–∞" - –ø–æ–ª—É—á–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç –ê–∫—ã–ª–±–µ–∫–∞<br>
                        ‚Ä¢ –ê—Å–∞–Ω–±–µ–∫ & –ê–∫—ã–ª–±–µ–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π!
                    </small>
                </div>
            </div>

            <!-- –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–¢–ï–ì–û–†–ò–Ø–ú–ò -->
            <div class="settings-section">
                <h4>üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</h4>
                <p style="color: #9fbffd; font-size: 12px; margin-bottom: 10px;">–î–æ–±–∞–≤–ª—è–π—Ç–µ, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–π—Ç–µ –∏–ª–∏ —É–¥–∞–ª—è–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</p>
                <div id="mainCategoriesManager"></div>
                <div style="margin-top: 15px;">
                    <div class="category-item">
                        <input type="text" id="newCategoryName" placeholder="–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è">
                        <button class="btn btn-success btn-sm" onclick="addNewCategory()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h4>üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</h4>
                <p style="color: #9fbffd; font-size: 12px; margin-bottom: 10px;">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏:</p>
                <div id="categoriesManager"></div>
            </div>

            <div class="settings-section">
                <h4>üß™ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–∞–º–∏ –ù–î —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h4>
                <p style="color: #9fbffd; font-size: 12px; margin-bottom: 10px;">–î–æ–±–∞–≤–ª—è–π—Ç–µ –∏–ª–∏ —É–¥–∞–ª—è–π—Ç–µ —Ç–∏–ø—ã —Ç–µ—Å—Ç–æ–≤:</p>
                <div id="ndTestTypesManager"></div>
            </div>

            <div class="settings-section">
                <h4>üíæ –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç</h4>
                <div class="form-group">
                    <label>–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ JSON:</label>
                    <input type="file" id="importFile" accept=".json">
                    <button class="btn btn-success" onclick="importFromFile()">
                        <i class="fas fa-upload"></i> –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
            </div>

            <div class="settings-section">
                <h4>‚ö†Ô∏è –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</h4>
                <button class="btn btn-danger" onclick="clearAllData()">
                    <i class="fas fa-exclamation-triangle"></i> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                </button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É -->
<div id="addTaskModal" class="modal">
    <div class="modal-content">
        <h2>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</h2>
        <div class="form-group">
            <label>–î–∞—Ç–∞:</label>
            <input type="date" id="taskDate">
        </div>
        <div class="form-group">
            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
            <select id="taskCategory" onchange="updateSubcategories()">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
            </select>
        </div>
        <div class="form-group">
            <label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
            <select id="taskSubcategory" onchange="toggleCustomSubcategory()">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
            </select>
        </div>
        <div class="form-group" id="customSubcategoryGroup" style="display: none;">
            <label>–ù–æ–≤–∞—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
            <input type="text" id="taskCustomSubcategory" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
        </div>
        <div class="form-group">
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
            <input type="text" id="taskName">
        </div>
        <div class="form-group">
            <label>–í—Ä–µ–º—è (–ß–ß:–ú–ú, –Ω–∞–ø—Ä–∏–º–µ—Ä 2:30):</label>
            <input type="text" id="taskHours" placeholder="0:00" pattern="[0-9]{1,2}:[0-5][0-9]">
        </div>
        <div class="form-group">
            <label>–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä:</label>
            <select id="taskInstructor">
                <option value="asanbek">–ê—Å–∞–Ω–±–µ–∫</option>
                <option value="akylbek">–ê–∫—ã–ª–±–µ–∫</option>
            </select>
        </div>
        <div class="form-group">
            <label>–°—Ç–∞—Ç—É—Å:</label>
            <select id="taskStatus">
                <option value="–û–∂–∏–¥–∞–Ω–∏–µ">–û–∂–∏–¥–∞–Ω–∏–µ</option>
                <option value="–ù–∞—á–∞—Ç–æ">–ù–∞—á–∞—Ç–æ</option>
                <option value="–í—ã–ø–æ–ª–Ω–µ–Ω–æ">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
            </select>
        </div>
        <div class="modal-buttons">
            <button class="btn" onclick="closeModal('addTaskModal')">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn btn-success" onclick="addTask()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ï–ò–°–û–¢ -->
<div id="eIsotModal" class="modal">
    <div class="modal-content">
        <h2>–î–æ–±–∞–≤–∏—Ç—å –ï–ò–°–û–¢</h2>
        <div class="form-group">
            <label>–î–∞—Ç–∞:</label>
            <input type="date" id="eIsotDate">
        </div>
        <div class="form-group">
            <label>–°–æ—Ç—Ä—É–¥–Ω–∏–∫:</label>
            <input type="text" id="eIsotEmployee">
        </div>
        <div class="form-group">
            <label>–í—Ä–µ–º—è (–º–∏–Ω):</label>
            <input type="number" id="eIsotTime">
        </div>
        <div class="modal-buttons">
            <button class="btn" onclick="closeModal('eIsotModal')">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn btn-success" onclick="addEIsot()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ü—Ä–æ–º–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å -->
<div id="prombezModal" class="modal">
    <div class="modal-content">
        <h2>–î–æ–±–∞–≤–∏—Ç—å –ü—Ä–æ–º–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h2>
        <div class="form-group">
            <label>–î–∞—Ç–∞:</label>
            <input type="date" id="prombezDate">
        </div>
        <div class="form-group">
            <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
            <textarea id="prombezDescription" rows="3"></textarea>
        </div>
        <div class="modal-buttons">
            <button class="btn" onclick="closeModal('prombezModal')">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn btn-success" onclick="addPrombez()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ù–î —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
<div id="ndTestingModal" class="modal">
    <div class="modal-content">
        <h2>–î–æ–±–∞–≤–∏—Ç—å –ù–î —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
        <div class="form-group">
            <label>–î–∞—Ç–∞:</label>
            <input type="date" id="ndTestDate">
        </div>
        <div class="form-group">
            <label>–¢–∏–ø:</label>
            <select id="ndTestType">
                <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </select>
        </div>
        <div class="form-group">
            <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
            <textarea id="ndTestDesc" rows="3"></textarea>
        </div>
        <div class="modal-buttons">
            <button class="btn" onclick="closeModal('ndTestingModal')">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn btn-success" onclick="addNDTesting()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
</div>

<script>
// ============= –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï =============
var currentUser = 'asanbek';
var tasks = [];
var eIsotResults = [];
var prombezResults = [];
var ndTestingResults = [];
var fullHistory = [];
var categories = {
    "–ü—Ä–∏—ë–º—ã –Ω–æ–≤—ã—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤":["–ü—Ä–∏–∫–∞–∑—ã","–ò–û–¢-–û–ü–†","–í–≤–æ–¥–Ω–∞—è —Ñ–æ—Ä–º–∞","–ù–∞ —Ä–∞–±–æ—á–µ–º –º–µ—Å—Ç–µ","–ñ—É—Ä–Ω–∞–ª—ã –≠–ë","–ü–æ–∂–∞—Ä–Ω—ã–π (–≤–≤–æ–¥–Ω—ã–π)","–ü–æ–∂–∞—Ä–Ω—ã–π (–ø–µ—Ä–≤–∏—á–Ω—ã–π)","–£–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ –£–ß","QR –∫–æ–¥—ã –∏ —Ñ–æ—Ç–æ","–°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞","–¢—Ä–µ–π–Ω–∏–Ω–≥ –∫–∞—Ä—Ç","–ü—Ä–æ—Ü–µ–¥—É—Ä—ã","–ü—Ä–æ–∏–∑–≤. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏","–†–µ–µ—Å—Ç—Ä –ú–∏–Ω—Ç—Ä—É–¥","‚ûï –î—Ä—É–≥–æ–µ"],
    "–î–æ–ø –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏":["–†–∞–±–æ—á–∏–π –ª—é–ª—å–∫–∏-–ü—Ä–∏–∫–∞–∑","–†–∞–±–æ—á–∏–π –ª—é–ª—å–∫–∏-–ü—Ä–æ—Ç–æ–∫–æ–ª","–†–∞–±–æ—á–∏–π –ª—é–ª—å–∫–∏-–£–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ","–ú–∞—à–∏–Ω–∏—Å—Ç—ã –ê–ì–ü-–ü—Ä–∏–∫–∞–∑","–ú–∞—à–∏–Ω–∏—Å—Ç—ã –ê–ì–ü-–ò–û–¢","–ú–∞—à–∏–Ω–∏—Å—Ç—ã –ê–ì–ü-–°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞","–ú–∞—à–∏–Ω–∏—Å—Ç—ã –ê–ì–ü-–£–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ","–û–ó–ü-–ü—Ä–∏–∫–∞–∑","–û–ó–ü-–ò–û–¢","–û–ó–ü-–°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞","–û–ó–ü-–û–±—É—á–µ–Ω–∏–µ –≤ –∫–ª–∞—Å—Å–µ","‚ûï –î—Ä—É–≥–æ–µ"],
    "–ò–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–∏":["–î–µ–Ω—å 1 - –í–≤–æ–¥–Ω—ã–π","–î–µ–Ω—å 2 - –ü–µ—Ä–≤–∞—è –ø–æ–º–æ—â—å","–î–µ–Ω—å 3 - –û–≥–Ω–µ–≤—ã–µ —Ä–∞–±–æ—Ç—ã","–î–µ–Ω—å 4 - –†–∞–±–æ—Ç–∞ –ø–æ –ù–î","–î–µ–Ω—å 5 - –†–∞–±–æ—Ç–∞ –Ω–∞ –≤—ã—Å–æ—Ç–µ","–ú–∞—à–∏–Ω–∏—Å—Ç—ã –ê–ì–ü","–†–∞–±–æ—á–∏–π –ª—é–ª—å–∫–∏","–û–ó–ü","–°—Ç–æ—Ä–æ–Ω–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏","‚ûï –î—Ä—É–≥–æ–µ"],
    "–û–±—É—á–µ–Ω–∏–µ":["–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –≠–ë","–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –Ω–∞ –≤—ã—Å–æ—Ç–µ","–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ù–î","–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –≥—Ä—É–∑–æ–ø–æ–¥—ä—ë–º","–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –∑–µ–º–ª—è–Ω—ã–µ —Ä–∞–±–æ—Ç—ã","–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å","‚ûï –î—Ä—É–≥–æ–µ"],
    "–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –æ–±—É—á–µ–Ω–∏—è":["–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ-–í –≤—ã—Å–æ—Ç–∞","–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ-–≠–ë","–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ-–î–æ–ø –ø—Ä–æ—Ñ","‚ûï –î—Ä—É–≥–æ–µ"],
    "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ":["–ï–ò–°–û–¢ –¥–ª—è –°–û–¢","–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å","‚ûï –î—Ä—É–≥–æ–µ"]
};

var ndTestTypes = [
    "–¢–µ—Å—Ç –¥–ª—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ –ù–î",
    "–ò–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂ –∏ —Ç–µ—Å—Ç –ø–æ –ù–î",
    "–ò–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂ –∏ —Ç–µ—Å—Ç –ø–æ –≤—ã—Å–æ—Ç–µ",
    "–ò–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂ –∏ —Ç–µ—Å—Ç –ø–æ –≠–ë",
    "–ò–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂ –∏ —Ç–µ—Å—Ç –ø–æ –≥—Ä—É–∑–æ–ø–æ–¥—ä–µ–º—É"
];

var statusChartInstance = null;
var categoryChartInstance = null;
var weeklyTrendChartInstance = null;
var instructorChartInstance = null;
var heatmapChartInstance = null;
var forecastChartInstance = null;

// ============= –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –í–†–ï–ú–ï–ù–ï–ú (–ß–ß:–ú–ú) =============
function timeToMinutes(timeStr) {
    if (!timeStr || timeStr === '0:00') return 0;
    var parts = timeStr.split(':');
    var hours = parseInt(parts[0]) || 0;
    var minutes = parseInt(parts[1]) || 0;
    return hours * 60 + minutes;
}

function minutesToTime(minutes) {
    var hours = Math.floor(minutes / 60);
    var mins = minutes % 60;
    return hours + ':' + (mins < 10 ? '0' + mins : mins);
}

function minutesToDecimalHours(minutes) {
    return (minutes / 60).toFixed(2);
}

// ============= –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =============
function init() {
    loadData();
    changeUser();
    populateCategories();
    showTasks();
    updateStats();
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ XLSX –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
    if (typeof XLSX === 'undefined') {
        console.warn('‚ö†Ô∏è XLSX –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ CDN');
    } else {
        console.log('‚úÖ XLSX –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
    }
}

function loadData() {
    try {
        tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        eIsotResults = JSON.parse(localStorage.getItem('eIsotResults')) || [];
        prombezResults = JSON.parse(localStorage.getItem('prombezResults')) || [];
        ndTestingResults = JSON.parse(localStorage.getItem('ndTestingResults')) || [];
        fullHistory = JSON.parse(localStorage.getItem('fullHistory')) || [];
        var savedCategories = JSON.parse(localStorage.getItem('categories'));
        if (savedCategories) categories = savedCategories;
        var savedNdTestTypes = JSON.parse(localStorage.getItem('ndTestTypes'));
        if (savedNdTestTypes) ndTestTypes = savedNdTestTypes;
        
        // –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        tasks.forEach(function(task) {
            if (task.hoursSpent !== undefined && task.hoursMinutes === undefined) {
                task.hoursMinutes = Math.round(task.hoursSpent * 60);
                delete task.hoursSpent;
            }
        });
    } catch(e) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
    }
}

function saveData() {
    try {
        localStorage.setItem('tasks', JSON.stringify(tasks));
        localStorage.setItem('eIsotResults', JSON.stringify(eIsotResults));
        localStorage.setItem('prombezResults', JSON.stringify(prombezResults));
        localStorage.setItem('ndTestingResults', JSON.stringify(ndTestingResults));
        localStorage.setItem('fullHistory', JSON.stringify(fullHistory));
        localStorage.setItem('categories', JSON.stringify(categories));
        localStorage.setItem('ndTestTypes', JSON.stringify(ndTestTypes));
    } catch(e) {
        alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö');
    }
}

function changeUser() {
    currentUser = document.getElementById('userSelect').value;
    document.getElementById('userDisplay').textContent = 'üë§ ' + (currentUser === 'asanbek' ? '–ê—Å–∞–Ω–±–µ–∫' : '–ê–∫—ã–ª–±–µ–∫');
    document.getElementById('taskInstructor').value = currentUser;
}

function populateCategories() {
    var catSelect = document.getElementById('taskCategory');
    var filterSelect = document.getElementById('filterCategory');
    
    catSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';
    filterSelect.innerHTML = '<option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>';
    
    for (var cat in categories) {
        catSelect.innerHTML += '<option value="' + cat + '">' + cat + '</option>';
        filterSelect.innerHTML += '<option value="' + cat + '">' + cat + '</option>';
    }
}

function updateSubcategories() {
    var cat = document.getElementById('taskCategory').value;
    var subSelect = document.getElementById('taskSubcategory');
    subSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';
    
    if (cat && categories[cat]) {
        categories[cat].forEach(function(sub) {
            subSelect.innerHTML += '<option value="' + sub + '">' + sub + '</option>';
        });
    }
}

function toggleCustomSubcategory() {
    var subcat = document.getElementById('taskSubcategory').value;
    var customGroup = document.getElementById('customSubcategoryGroup');
    
    if (subcat === '‚ûï –î—Ä—É–≥–æ–µ') {
        customGroup.style.display = 'block';
    } else {
        customGroup.style.display = 'none';
    }
}

// ============= –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê =============
function showModal(id) {
    var modal = document.getElementById(id);
    modal.classList.add('show');
    
    if (id === 'addTaskModal') {
        document.getElementById('taskDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('taskInstructor').value = currentUser;
        document.getElementById('taskHours').value = '0:00';
    }
    if (id === 'eIsotModal') {
        document.getElementById('eIsotDate').value = new Date().toISOString().split('T')[0];
    }
    if (id === 'prombezModal') {
        document.getElementById('prombezDate').value = new Date().toISOString().split('T')[0];
    }
    if (id === 'ndTestingModal') {
        document.getElementById('ndTestDate').value = new Date().toISOString().split('T')[0];
        populateNdTestTypes();
    }
}

function populateNdTestTypes() {
    var select = document.getElementById('ndTestType');
    select.innerHTML = '';
    ndTestTypes.forEach(function(type) {
        select.innerHTML += '<option value="' + type + '">' + type + '</option>';
    });
}

function closeModal(id) {
    document.getElementById(id).classList.remove('show');
}

// ============= –ó–ê–î–ê–ß–ò =============
function addTask() {
    var date = document.getElementById('taskDate').value;
    var cat = document.getElementById('taskCategory').value;
    var subcat = document.getElementById('taskSubcategory').value;
    var customSubcat = document.getElementById('taskCustomSubcategory').value.trim();
    var name = document.getElementById('taskName').value.trim();
    var hoursInput = document.getElementById('taskHours').value.trim();
    var inst = document.getElementById('taskInstructor').value;
    var status = document.getElementById('taskStatus').value;
    
    if (!date || !cat || !name) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
        return;
    }

    if (subcat === '‚ûï –î—Ä—É–≥–æ–µ' && customSubcat) {
        subcat = customSubcat;
        if (categories[cat].indexOf(customSubcat) === -1) {
            categories[cat][categories[cat].length - 1] = customSubcat;
            categories[cat].push('‚ûï –î—Ä—É–≥–æ–µ');
        }
    } else if (!subcat || subcat === '‚ûï –î—Ä—É–≥–æ–µ') {
        alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é!');
        return;
    }
    
    var hoursMinutes = timeToMinutes(hoursInput);
    
    tasks.push({
        id: Date.now(),
        date: date,
        category: cat,
        subcategory: subcat,
        name: name,
        hoursMinutes: hoursMinutes,
        assignedTo: inst,
        status: status,
        createdAt: new Date().toISOString(),
        startedAt: status === '–ù–∞—á–∞—Ç–æ' ? new Date().toISOString() : null,
        completedAt: status === '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' ? new Date().toISOString() : null
    });
    
    saveData();
    closeModal('addTaskModal');
    showTasks();
    addToFullHistory('–ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞: ' + name);
    document.getElementById('taskCustomSubcategory').value = '';
    alert('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
}

function deleteTask(id) {
    var task = tasks.find(function(t) { return t.id === id; });
    if (!task) return;
    
    var message = '‚ö†Ô∏è –í–´ –£–í–ï–†–ï–ù–´ –ß–¢–û –•–û–¢–ò–¢–ï –£–î–ê–õ–ò–¢–¨ –≠–¢–£ –ó–ê–ü–ò–°–¨?\n\n';
    message += 'üìÖ –î–∞—Ç–∞: ' + task.date + '\n';
    message += 'üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ' + task.category + '\n';
    message += 'üìÇ –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è: ' + task.subcategory + '\n';
    message += 'üìù –ù–∞–∑–≤–∞–Ω–∏–µ: ' + task.name + '\n';
    message += 'üë§ –ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä: ' + (task.assignedTo === 'asanbek' ? '–ê—Å–∞–Ω–±–µ–∫' : '–ê–∫—ã–ª–±–µ–∫') + '\n';
    message += '‚è±Ô∏è –í—Ä–µ–º—è: ' + minutesToTime(task.hoursMinutes) + '\n';
    message += 'üìä –°—Ç–∞—Ç—É—Å: ' + task.status + '\n\n';
    message += '–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!';
    
    if (confirm(message)) {
        tasks = tasks.filter(function(t) { return t.id !== id; });
        saveData();
        showTasks();
        addToFullHistory('–ó–∞–¥–∞—á–∞ —É–¥–∞–ª–µ–Ω–∞: ' + task.name + ' (' + task.category + ' - ' + task.subcategory + ')');
    }
}

function showTasks() {
    var catFilter = document.getElementById('filterCategory').value;
    var statusFilter = document.getElementById('filterStatus').value;
    
    // ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –æ—Ç –°–¢–ê–†–´–• –∫ –ù–û–í–´–ú (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≤–Ω–∏–∑—É)
    var filtered = tasks.filter(function(t) {
        if (catFilter && t.category !== catFilter) return false;
        if (statusFilter && t.status !== statusFilter) return false;
        return true;
    }).sort(function(a, b) {
        return new Date(a.date) - new Date(b.date);
    });

    var html = '';
    filtered.forEach(function(task) {
        var badgeClass = task.status === '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' ? 'badge-done' : 
                        task.status === '–ù–∞—á–∞—Ç–æ' ? 'badge-started' : 'badge-pending';
        html += '<tr>';
        html += '<td>' + task.date + '</td>';
        html += '<td>' + task.category + '</td>';
        html += '<td>' + task.subcategory + '</td>';
        html += '<td><strong>' + task.name + '</strong></td>';
        html += '<td>' + (task.assignedTo === 'asanbek' ? '–ê—Å–∞–Ω–±–µ–∫' : '–ê–∫—ã–ª–±–µ–∫') + '</td>';
        
        html += '<td><input type="text" value="' + minutesToTime(task.hoursMinutes) + '" onchange="updateTaskHours(' + task.id + ', this.value)" style="width: 70px; padding: 5px; text-align: center;" pattern="[0-9]{1,2}:[0-5][0-9]"></td>';
        
        html += '<td><div style="display: flex; gap: 5px; flex-wrap: wrap;">';
        if (task.status !== '–û–∂–∏–¥–∞–Ω–∏–µ') {
            html += '<button class="btn btn-sm badge-pending" onclick="changeTaskStatus(' + task.id + ', \'–û–∂–∏–¥–∞–Ω–∏–µ\')" title="–û–∂–∏–¥–∞–Ω–∏–µ" style="padding: 4px 8px;">‚è∏Ô∏è</button>';
        }
        if (task.status !== '–ù–∞—á–∞—Ç–æ') {
            html += '<button class="btn btn-sm badge-started" onclick="changeTaskStatus(' + task.id + ', \'–ù–∞—á–∞—Ç–æ\')" title="–ù–∞—á–∞—Ç–æ" style="padding: 4px 8px;">‚ñ∂Ô∏è</button>';
        }
        if (task.status !== '–í—ã–ø–æ–ª–Ω–µ–Ω–æ') {
            html += '<button class="btn btn-sm badge-done" onclick="changeTaskStatus(' + task.id + ', \'–í—ã–ø–æ–ª–Ω–µ–Ω–æ\')" title="–í—ã–ø–æ–ª–Ω–µ–Ω–æ" style="padding: 4px 8px;">‚úÖ</button>';
        }
        html += '<span class="badge ' + badgeClass + '" style="padding: 4px 8px;">' + task.status + '</span>';
        html += '</div></td>';
        
        html += '<td><button class="btn btn-danger btn-sm" onclick="deleteTask(' + task.id + ')"><i class="fas fa-trash"></i></button></td>';
        html += '</tr>';
    });

    document.getElementById('tasksTable').innerHTML = html || '<tr><td colspan="8">–ù–µ—Ç –∑–∞–¥–∞—á</td></tr>';
    updateStats();
}

function changeTaskStatus(id, newStatus) {
    var task = tasks.find(function(t) { return t.id === id; });
    if (task) {
        var oldStatus = task.status;
        task.status = newStatus;
        
        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        if (newStatus === '–ù–∞—á–∞—Ç–æ' && !task.startedAt) {
            task.startedAt = new Date().toISOString();
        }
        if (newStatus === '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' && !task.completedAt) {
            task.completedAt = new Date().toISOString();
        }
        
        saveData();
        showTasks();
        addToFullHistory('–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω—ë–Ω: "' + task.name + '" —Å "' + oldStatus + '" –Ω–∞ "' + newStatus + '"');
    }
}

function updateTaskHours(id, timeStr) {
    var task = tasks.find(function(t) { return t.id === id; });
    if (task) {
        var oldTime = minutesToTime(task.hoursMinutes);
        task.hoursMinutes = timeToMinutes(timeStr);
        saveData();
        updateStats();
        addToFullHistory('–í—Ä–µ–º—è –∏–∑–º–µ–Ω–µ–Ω–æ: "' + task.name + '" —Å ' + oldTime + ' –Ω–∞ ' + minutesToTime(task.hoursMinutes));
    }
}

// ============= –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï =============
function addEIsot() {
    var date = document.getElementById('eIsotDate').value;
    var emp = document.getElementById('eIsotEmployee').value.trim();
    var time = parseInt(document.getElementById('eIsotTime').value) || 0;
    
    if (!date || !emp) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
        return;
    }
    
    eIsotResults.push({
        id: Date.now(),
        date: date,
        instructor: currentUser,
        employee: emp,
        time: time
    });
    
    saveData();
    closeModal('eIsotModal');
    renderEIsot();
    addToFullHistory('–ï–ò–°–û–¢ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–ª—è ' + emp);
    alert('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
}

function renderEIsot() {
    var html = '';
    // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –æ—Ç –°–¢–ê–†–´–• –∫ –ù–û–í–´–ú
    eIsotResults.sort(function(a, b) {
        return new Date(a.date) - new Date(b.date);
    }).forEach(function(r) {
        html += '<tr>';
        html += '<td>' + r.date + '</td>';
        html += '<td>' + (r.instructor === 'asanbek' ? '–ê—Å–∞–Ω–±–µ–∫' : '–ê–∫—ã–ª–±–µ–∫') + '</td>';
        html += '<td>' + r.employee + '</td>';
        html += '<td>' + r.time + '</td>';
        html += '<td><button class="btn btn-danger btn-sm" onclick="deleteEIsot(' + r.id + ')"><i class="fas fa-trash"></i></button></td>';
        html += '</tr>';
    });
    document.getElementById('eIsotTable').innerHTML = html || '<tr><td colspan="5">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</td></tr>';
}

function deleteEIsot(id) {
    var record = eIsotResults.find(function(r) { return r.id === id; });
    if (!record) return;
    
    var message = '‚ö†Ô∏è –í–´ –£–í–ï–†–ï–ù–´ –ß–¢–û –•–û–¢–ò–¢–ï –£–î–ê–õ–ò–¢–¨ –≠–¢–£ –ó–ê–ü–ò–°–¨ –ï–ò–°–û–¢?\n\n';
    message += 'üìÖ –î–∞—Ç–∞: ' + record.date + '\n';
    message += 'üë§ –ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä: ' + (record.instructor === 'asanbek' ? '–ê—Å–∞–Ω–±–µ–∫' : '–ê–∫—ã–ª–±–µ–∫') + '\n';
    message += 'üë®‚Äçüíº –°–æ—Ç—Ä—É–¥–Ω–∏–∫: ' + record.employee + '\n';
    message += '‚è±Ô∏è –í—Ä–µ–º—è: ' + record.time + ' –º–∏–Ω\n\n';
    message += '–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!';
    
    if (confirm(message)) {
        eIsotResults = eIsotResults.filter(function(r) { return r.id !== id; });
        saveData();
        renderEIsot();
        addToFullHistory('–ï–ò–°–û–¢ —É–¥–∞–ª–µ–Ω–∞: ' + record.employee);
    }
}

function addPrombez() {
    var date = document.getElementById('prombezDate').value;
    var desc = document.getElementById('prombezDescription').value.trim();
    
    if (!date || !desc) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
        return;
    }
    
    prombezResults.push({
        id: Date.now(),
        date: date,
        instructor: currentUser,
        description: desc
    });
    
    saveData();
    closeModal('prombezModal');
    renderPrombez();
    addToFullHistory('–ü—Ä–æ–º–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞');
    alert('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
}

function renderPrombez() {
    var html = '';
    // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –æ—Ç –°–¢–ê–†–´–• –∫ –ù–û–í–´–ú
    prombezResults.sort(function(a, b) {
        return new Date(a.date) - new Date(b.date);
    }).forEach(function(r) {
        html += '<tr>';
        html += '<td>' + r.date + '</td>';
        html += '<td>' + (r.instructor === 'asanbek' ? '–ê—Å–∞–Ω–±–µ–∫' : '–ê–∫—ã–ª–±–µ–∫') + '</td>';
        html += '<td>' + r.description + '</td>';
        html += '<td><button class="btn btn-danger btn-sm" onclick="deletePrombez(' + r.id + ')"><i class="fas fa-trash"></i></button></td>';
        html += '</tr>';
    });
    document.getElementById('prombezTable').innerHTML = html || '<tr><td colspan="4">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</td></tr>';
}

function deletePrombez(id) {
    var record = prombezResults.find(function(r) { return r.id === id; });
    if (!record) return;
    
    var message = '‚ö†Ô∏è –í–´ –£–í–ï–†–ï–ù–´ –ß–¢–û –•–û–¢–ò–¢–ï –£–î–ê–õ–ò–¢–¨ –≠–¢–£ –ó–ê–ü–ò–°–¨ –ü–†–û–ú–ë–ï–ó?\n\n';
    message += 'üìÖ –î–∞—Ç–∞: ' + record.date + '\n';
    message += 'üë§ –ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä: ' + (record.instructor === 'asanbek' ? '–ê—Å–∞–Ω–±–µ–∫' : '–ê–∫—ã–ª–±–µ–∫') + '\n';
    message += 'üìù –û–ø–∏—Å–∞–Ω–∏–µ: ' + record.description + '\n\n';
    message += '–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!';
    
    if (confirm(message)) {
        prombezResults = prombezResults.filter(function(r) { return r.id !== id; });
        saveData();
        renderPrombez();
        addToFullHistory('–ü—Ä–æ–º–±–µ–∑ –∑–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞');
    }
}

function addNDTesting() {
    var date = document.getElementById('ndTestDate').value;
    var type = document.getElementById('ndTestType').value;
    var desc = document.getElementById('ndTestDesc').value.trim();
    
    if (!date || !type || !desc) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
        return;
    }
    
    ndTestingResults.push({
        id: Date.now(),
        date: date,
        type: type,
        instructor: currentUser,
        description: desc
    });
    
    saveData();
    closeModal('ndTestingModal');
    renderNDTesting();
    addToFullHistory('–ù–î —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: ' + type);
    alert('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
}

function renderNDTesting() {
    var html = '';
    // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –æ—Ç –°–¢–ê–†–´–• –∫ –ù–û–í–´–ú
    ndTestingResults.sort(function(a, b) {
        return new Date(a.date) - new Date(b.date);
    }).forEach(function(r) {
        html += '<tr>';
        html += '<td>' + r.date + '</td>';
        html += '<td>' + r.type + '</td>';
        html += '<td>' + (r.instructor === 'asanbek' ? '–ê—Å–∞–Ω–±–µ–∫' : '–ê–∫—ã–ª–±–µ–∫') + '</td>';
        html += '<td>' + r.description + '</td>';
        html += '<td><button class="btn btn-danger btn-sm" onclick="deleteNDTesting(' + r.id + ')"><i class="fas fa-trash"></i></button></td>';
        html += '</tr>';
    });
    document.getElementById('ndTestingTable').innerHTML = html || '<tr><td colspan="5">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</td></tr>';
}

function deleteNDTesting(id) {
    var record = ndTestingResults.find(function(r) { return r.id === id; });
    if (!record) return;
    
    var message = '‚ö†Ô∏è –í–´ –£–í–ï–†–ï–ù–´ –ß–¢–û –•–û–¢–ò–¢–ï –£–î–ê–õ–ò–¢–¨ –≠–¢–£ –ó–ê–ü–ò–°–¨ –ù–î –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø?\n\n';
    message += 'üìÖ –î–∞—Ç–∞: ' + record.date + '\n';
    message += 'üß™ –¢–∏–ø: ' + record.type + '\n';
    message += 'üë§ –ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä: ' + (record.instructor === 'asanbek' ? '–ê—Å–∞–Ω–±–µ–∫' : '–ê–∫—ã–ª–±–µ–∫') + '\n';
    message += 'üìù –û–ø–∏—Å–∞–Ω–∏–µ: ' + record.description + '\n\n';
    message += '–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!';
    
    if (confirm(message)) {
        ndTestingResults = ndTestingResults.filter(function(r) { return r.id !== id; });
        saveData();
        renderNDTesting();
        addToFullHistory('–ù–î —Ç–µ—Å—Ç —É–¥–∞–ª—ë–Ω: ' + record.type);
    }
}

// ============= –°–¢–ê–¢–ò–°–¢–ò–ö–ê =============
function updateStats() {
    var total = tasks.length;
    var completed = tasks.filter(function(t) { return t.status === '–í—ã–ø–æ–ª–Ω–µ–Ω–æ'; });
    var inProgress = tasks.filter(function(t) { return t.status === '–ù–∞—á–∞—Ç–æ'; });
    var totalMinutes = tasks.reduce(function(sum, t) { return sum + t.hoursMinutes; }, 0);
    var asanbek = completed.filter(function(t) { return t.assignedTo === 'asanbek'; }).length;
    var akylbek = completed.filter(function(t) { return t.assignedTo === 'akylbek'; }).length;
    
    document.getElementById('totalTasks').textContent = total;
    document.getElementById('completedTasks').textContent = completed.length;
    document.getElementById('inProgressTasks').textContent = inProgress.length;
    document.getElementById('totalHours').textContent = minutesToTime(totalMinutes);
    document.getElementById('statAsanbek').textContent = asanbek;
    document.getElementById('statAkylbek').textContent = akylbek;
}

function showAnalytics(type) {
    var completed = tasks.filter(function(t) { return t.status === '–í—ã–ø–æ–ª–Ω–µ–Ω–æ'; });
    var html = '<table style="width:100%"><thead><tr><th>–î–∞—Ç–∞</th><th>–û–±—É—á–µ–Ω–∏–π</th><th>–í—Ä–µ–º—è</th></tr></thead><tbody>';
    
    if (type === 'weekly') {
        var today = new Date();
        var weekStart = new Date(today);
        weekStart.setDate(today.getDate() - today.getDay() + 1);
        for (var i = 0; i < 7; i++) {
            var d = new Date(weekStart);
            d.setDate(d.getDate() + i);
            var ds = d.toISOString().split('T')[0];
            var count = completed.filter(function(t) { return t.date === ds; }).length;
            var mins = completed.filter(function(t) { return t.date === ds; }).reduce(function(s, t) { return s + t.hoursMinutes; }, 0);
            html += '<tr><td>' + ds + '</td><td>' + count + '</td><td>' + minutesToTime(mins) + '</td></tr>';
        }
    } else {
        var today = new Date();
        var year = today.getFullYear();
        var month = today.getMonth();
        var monthCount = 0;
        var monthMinutes = 0;
        completed.forEach(function(t) {
            var td = new Date(t.date);
            if (td.getMonth() === month && td.getFullYear() === year) {
                monthCount++;
                monthMinutes += t.hoursMinutes;
            }
        });
        html += '<tr><td>–í—Å–µ–≥–æ:</td><td>' + monthCount + '</td><td>' + minutesToTime(monthMinutes) + '</td></tr>';
    }
    
    html += '</tbody></table>';
    document.getElementById('analyticsContent').innerHTML = html;
}

// ============= –î–ê–®–ë–û–†–î =============
function renderDashboard() {
    updateStats();
    renderKPI();
    renderStatusChart();
    renderCategoryChart();
    renderWeeklyTrendChart();
}

function renderKPI() {
    var total = tasks.length;
    var completed = tasks.filter(function(t) { return t.status === '–í—ã–ø–æ–ª–Ω–µ–Ω–æ'; });
    var completionRate = total > 0 ? (completed.length / total * 100).toFixed(1) : 0;
    
    var totalMinutes = tasks.reduce(function(s, t) { return s + t.hoursMinutes; }, 0);
    var avgMinutes = total > 0 ? Math.round(totalMinutes / total) : 0;
    
    var thisWeek = tasks.filter(function(t) {
        var taskDate = new Date(t.date);
        var today = new Date();
        var weekStart = new Date(today);
        weekStart.setDate(today.getDate() - today.getDay() + 1);
        return taskDate >= weekStart && taskDate <= today;
    }).length;
    
    var html = '';
    html += '<div class="kpi-item">';
    html += '<div class="kpi-value">' + completionRate + '%</div>';
    html += '<div class="kpi-label">–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</div>';
    html += '<div class="progress-bar"><div class="progress-fill" style="width:' + completionRate + '%"></div></div>';
    html += '</div>';
    
    html += '<div class="kpi-item">';
    html += '<div class="kpi-value">' + minutesToTime(avgMinutes) + '</div>';
    html += '<div class="kpi-label">–°—Ä–µ–¥–Ω. –≤—Ä–µ–º—è</div>';
    html += '</div>';
    
    html += '<div class="kpi-item">';
    html += '<div class="kpi-value">' + thisWeek + '</div>';
    html += '<div class="kpi-label">–ó–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é</div>';
    html += '</div>';
    
    document.getElementById('kpiGrid').innerHTML = html;
}

function renderStatusChart() {
    var ctx = document.getElementById('statusChart');
    if (!ctx) return;
    
    var notStarted = tasks.filter(function(t) { return t.status === '–û–∂–∏–¥–∞–Ω–∏–µ'; }).length;
    var inProgress = tasks.filter(function(t) { return t.status === '–ù–∞—á–∞—Ç–æ'; }).length;
    var completed = tasks.filter(function(t) { return t.status === '–í—ã–ø–æ–ª–Ω–µ–Ω–æ'; }).length;
    
    if (statusChartInstance) statusChartInstance.destroy();
    
    statusChartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['–û–∂–∏–¥–∞–Ω–∏–µ', '–ù–∞—á–∞—Ç–æ', '–í—ã–ø–æ–ª–Ω–µ–Ω–æ'],
            datasets: [{
                data: [notStarted, inProgress, completed],
                backgroundColor: ['#fcd34d', '#93c5fd', '#86efac'],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { color: '#e6eef8' }
                }
            }
        }
    });
}

function renderCategoryChart() {
    var ctx = document.getElementById('categoryChart');
    if (!ctx) return;
    
    var catCounts = {};
    tasks.forEach(function(t) {
        catCounts[t.category] = (catCounts[t.category] || 0) + 1;
    });
    
    var labels = Object.keys(catCounts);
    var data = Object.values(catCounts);
    
    if (categoryChartInstance) categoryChartInstance.destroy();
    
    categoryChartInstance = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: ['#60a5fa', '#3b82f6', '#2563eb', '#1d4ed8', '#1e40af'],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { color: '#e6eef8' }
                }
            }
        }
    });
}

function renderWeeklyTrendChart() {
    var ctx = document.getElementById('weeklyTrendChart');
    if (!ctx) return;
    
    var today = new Date();
    var weekStart = new Date(today);
    weekStart.setDate(today.getDate() - today.getDay() + 1);
    
    var labels = [];
    var data = [];
    
    for (var i = 0; i < 7; i++) {
        var d = new Date(weekStart);
        d.setDate(d.getDate() + i);
        var ds = d.toISOString().split('T')[0];
        labels.push(ds.split('-')[2] + '.' + ds.split('-')[1]);
        
        var count = tasks.filter(function(t) { 
            return t.date === ds && t.status === '–í—ã–ø–æ–ª–Ω–µ–Ω–æ';
        }).length;
        data.push(count);
    }
    
    if (weeklyTrendChartInstance) weeklyTrendChartInstance.destroy();
    
    weeklyTrendChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: '–í—ã–ø–æ–ª–Ω–µ–Ω–æ',
                data: data,
                borderColor: '#60a5fa',
                backgroundColor: 'rgba(96, 165, 250, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: '#e6eef8' },
                    grid: { color: 'rgba(255,255,255,0.1)' }
                },
                x: {
                    ticks: { color: '#e6eef8' },
                    grid: { color: 'rgba(255,255,255,0.1)' }
                }
            },
            plugins: {
                legend: {
                    labels: { color: '#e6eef8' }
                }
            }
        }
    });
}

function renderAnalytics() {
    renderInstructorChart();
    renderHeatmapChart();
    renderForecastChart();
}

function renderInstructorChart() {
    var ctx = document.getElementById('instructorChart');
    if (!ctx) return;
    
    var asanbek = tasks.filter(function(t) { return t.assignedTo === 'asanbek' && t.status === '–í—ã–ø–æ–ª–Ω–µ–Ω–æ'; }).length;
    var akylbek = tasks.filter(function(t) { return t.assignedTo === 'akylbek' && t.status === '–í—ã–ø–æ–ª–Ω–µ–Ω–æ'; }).length;
    
    var asanbekMinutes = tasks.filter(function(t) { return t.assignedTo === 'asanbek'; }).reduce(function(s, t) { return s + t.hoursMinutes; }, 0);
    var akylbekMinutes = tasks.filter(function(t) { return t.assignedTo === 'akylbek'; }).reduce(function(s, t) { return s + t.hoursMinutes; }, 0);
    
    if (instructorChartInstance) instructorChartInstance.destroy();
    
    instructorChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['–ê—Å–∞–Ω–±–µ–∫', '–ê–∫—ã–ª–±–µ–∫'],
            datasets: [
                {
                    label: '–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–µ–π',
                    data: [asanbek, akylbek],
                    backgroundColor: '#60a5fa'
                },
                {
                    label: '–ß–∞—Å–æ–≤ –æ–±—É—á–µ–Ω–∏—è (–¥–µ—Å—è—Ç–∏—á–Ω.)',
                    data: [minutesToDecimalHours(asanbekMinutes), minutesToDecimalHours(akylbekMinutes)],
                    backgroundColor: '#10b981'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: '#e6eef8' },
                    grid: { color: 'rgba(255,255,255,0.1)' }
                },
                x: {
                    ticks: { color: '#e6eef8' },
                    grid: { color: 'rgba(255,255,255,0.1)' }
                }
            },
            plugins: {
                legend: {
                    labels: { color: '#e6eef8' }
                }
            }
        }
    });
}

function renderHeatmapChart() {
    var ctx = document.getElementById('heatmapChart');
    if (!ctx) return;
    
    var months = {};
    tasks.forEach(function(t) {
        var month = t.date.substring(0, 7);
        months[month] = (months[month] || 0) + 1;
    });
    
    var labels = Object.keys(months).sort();
    var data = labels.map(function(m) { return months[m]; });
    
    if (heatmapChartInstance) heatmapChartInstance.destroy();
    
    heatmapChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: '–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –º–µ—Å—è—Ü–∞–º',
                data: data,
                backgroundColor: data.map(function(v) {
                    var max = Math.max.apply(null, data);
                    var intensity = v / max;
                    return 'rgba(96, 165, 250, ' + (0.2 + intensity * 0.8) + ')';
                })
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: '#e6eef8' },
                    grid: { color: 'rgba(255,255,255,0.1)' }
                },
                x: {
                    ticks: { color: '#e6eef8' },
                    grid: { color: 'rgba(255,255,255,0.1)' }
                }
            },
            plugins: {
                legend: {
                    labels: { color: '#e6eef8' }
                }
            }
        }
    });
}

function renderForecastChart() {
    var ctx = document.getElementById('forecastChart');
    if (!ctx) return;
    
    var today = new Date();
    var last3Months = [];
    
    for (var i = 2; i >= 0; i--) {
        var d = new Date(today);
        d.setMonth(d.getMonth() - i);
        last3Months.push(d.toISOString().substring(0, 7));
    }
    
    var avgPerMonth = 0;
    last3Months.forEach(function(month) {
        var count = tasks.filter(function(t) { return t.date.startsWith(month) && t.status === '–í—ã–ø–æ–ª–Ω–µ–Ω–æ'; }).length;
        avgPerMonth += count;
    });
    avgPerMonth = avgPerMonth / 3;
    
    var labels = [];
    var historicalData = [];
    var forecastData = [];
    
    last3Months.forEach(function(month) {
        labels.push(month);
        var count = tasks.filter(function(t) { return t.date.startsWith(month) && t.status === '–í—ã–ø–æ–ª–Ω–µ–Ω–æ'; }).length;
        historicalData.push(count);
        forecastData.push(null);
    });
    
    for (var i = 1; i <= 3; i++) {
        var d = new Date(today);
        d.setMonth(d.getMonth() + i);
        labels.push(d.toISOString().substring(0, 7));
        historicalData.push(null);
        forecastData.push(Math.round(avgPerMonth));
    }
    
    if (forecastChartInstance) forecastChartInstance.destroy();
    
    forecastChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: '–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ',
                    data: historicalData,
                    borderColor: '#60a5fa',
                    backgroundColor: 'rgba(96, 165, 250, 0.1)',
                    tension: 0.4
                },
                {
                    label: '–ü—Ä–æ–≥–Ω–æ–∑',
                    data: forecastData,
                    borderColor: '#f59e0b',
                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                    borderDash: [5, 5],
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: '#e6eef8' },
                    grid: { color: 'rgba(255,255,255,0.1)' }
                },
                x: {
                    ticks: { color: '#e6eef8' },
                    grid: { color: 'rgba(255,255,255,0.1)' }
                }
            },
            plugins: {
                legend: {
                    labels: { color: '#e6eef8' }
                }
            }
        }
    });
}

// ============= –ò–°–¢–û–†–ò–Ø =============
function addToFullHistory(action) {
    var today = new Date().toISOString().split('T')[0];
    var time = new Date().toLocaleTimeString('ru-RU');
    fullHistory.push({
        date: today,
        time: time,
        action: action,
        user: currentUser
    });
    saveData();
}

function renderHistory() {
    var filter = document.getElementById('historyFilter').value;
    var filtered = fullHistory.filter(function(h) {
        return !filter || h.user === filter;
    });
    
    var byDate = {};
    filtered.forEach(function(h) {
        if (!byDate[h.date]) byDate[h.date] = [];
        byDate[h.date].push(h);
    });
    
    var dates = Object.keys(byDate).sort().reverse();
    var html = '';
    dates.forEach(function(date) {
        var events = byDate[date];
        html += '<div class="history-day"><div class="history-day-header" onclick="toggleHistory(this)"><span>üìÖ ' + date + ' (' + events.length + ')</span><span>‚ñº</span></div><div class="history-day-content">';
        events.forEach(function(h) {
            html += '<div class="history-item"><strong>‚è∞ ' + h.time + '</strong> - ' + h.action + '<br><small>üë§ ' + (h.user === 'asanbek' ? '–ê—Å–∞–Ω–±–µ–∫' : '–ê–∫—ã–ª–±–µ–∫') + '</small></div>';
        });
        html += '</div></div>';
    });
    
    document.getElementById('historyContainer').innerHTML = html || '<p style="text-align:center; padding:20px; color:var(--text-secondary)">üì≠ –ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>';
}

function toggleHistory(el) {
    el.nextElementSibling.classList.toggle('show');
}

// ============= –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–¢–ï–ì–û–†–ò–Ø–ú–ò =============
function renderMainCategoriesManager() {
    var html = '<div style="padding: 15px; background: #0f1724; border-radius: 8px; border: 1px solid var(--border)">';
    
    var catKeys = Object.keys(categories);
    catKeys.forEach(function(cat, index) {
        html += '<div class="category-item">';
        html += '<input type="text" value="' + cat + '" id="maincat_' + index + '">';
        html += '<button class="btn btn-warning btn-sm" onclick="renameCategory(' + index + ', \'' + cat + '\')">‚úèÔ∏è –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å</button>';
        html += '<button class="btn btn-danger btn-sm" onclick="deleteCategory(\'' + cat + '\')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>';
        html += '</div>';
    });
    
    html += '</div>';
    document.getElementById('mainCategoriesManager').innerHTML = html;
}

function addNewCategory() {
    var newCat = document.getElementById('newCategoryName').value.trim();
    if (!newCat) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏!');
        return;
    }
    
    if (categories[newCat]) {
        alert('–¢–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
        return;
    }
    
    categories[newCat] = ['‚ûï –î—Ä—É–≥–æ–µ'];
    document.getElementById('newCategoryName').value = '';
    saveData();
    populateCategories();
    renderMainCategoriesManager();
    renderCategoriesManager();
    alert('‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
    addToFullHistory('–î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è: ' + newCat);
}

function renameCategory(index, oldName) {
    var newName = document.getElementById('maincat_' + index).value.trim();
    if (!newName || newName === oldName) return;
    
    if (categories[newName]) {
        alert('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
        return;
    }
    
    // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
    categories[newName] = categories[oldName];
    delete categories[oldName];
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–¥–∞—á–∏
    tasks.forEach(function(task) {
        if (task.category === oldName) {
            task.category = newName;
        }
    });
    
    saveData();
    populateCategories();
    renderMainCategoriesManager();
    renderCategoriesManager();
    showTasks();
    alert('‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞!');
    addToFullHistory('–ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞: "' + oldName + '" ‚Üí "' + newName + '"');
}

function deleteCategory(catName) {
    var tasksInCategory = tasks.filter(function(t) { return t.category === catName; }).length;
    
    var message = '‚ö†Ô∏è –£–î–ê–õ–ò–¢–¨ –ö–ê–¢–ï–ì–û–†–ò–Æ "' + catName + '"?\n\n';
    if (tasksInCategory > 0) {
        message += '‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ' + tasksInCategory + ' –∑–∞–¥–∞—á(–∏)!\n';
        message += '–í—Å–µ –∑–∞–¥–∞—á–∏ –±—É–¥—É—Ç —Ç–∞–∫–∂–µ —É–¥–∞–ª–µ–Ω—ã!\n\n';
    }
    message += '–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!';
    
    if (confirm(message)) {
        // –£–¥–∞–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        delete categories[catName];
        
        // –£–¥–∞–ª—è–µ–º –∑–∞–¥–∞—á–∏ –∏–∑ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        tasks = tasks.filter(function(t) { return t.category !== catName; });
        
        saveData();
        populateCategories();
        renderMainCategoriesManager();
        renderCategoriesManager();
        showTasks();
        alert('üóëÔ∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞!');
        addToFullHistory('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞: ' + catName + ' (' + tasksInCategory + ' –∑–∞–¥–∞—á)');
    }
}

function renderCategoriesManager() {
    var html = '';
    for (var cat in categories) {
        html += '<div style="margin-bottom: 15px; padding: 15px; background: #0f1724; border-radius: 8px; border: 1px solid var(--border)">';
        html += '<strong style="cursor: pointer; color: var(--accent); font-size: 16px" onclick="toggleCategoryEdit(\'' + cat + '\')">üìÅ ' + cat + '</strong>';
        html += '<div id="cat_' + cat + '" style="display: none; margin-top: 15px;">';
        
        for (var i = 0; i < categories[cat].length; i++) {
            var sub = categories[cat][i];
            if (sub === '‚ûï –î—Ä—É–≥–æ–µ') continue;
            html += '<div class="category-item">';
            html += '<input type="text" value="' + sub + '" id="sub_' + cat + '_' + i + '">';
            html += '<button class="btn btn-danger btn-sm" onclick="removeSubcategory(\'' + cat + '\', ' + i + ')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>';
            html += '</div>';
        }
        
        html += '<div class="category-item">';
        html += '<input type="text" id="new_' + cat + '" placeholder="–ù–æ–≤–∞—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è">';
        html += '<button class="btn btn-success btn-sm" onclick="addSubcategory(\'' + cat + '\')">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>';
        html += '</div>';
        html += '<button class="btn btn-sm" onclick="saveCategoryChanges(\'' + cat + '\')" style="margin-top: 10px;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>';
        html += '</div>';
        html += '</div>';
    }
    document.getElementById('categoriesManager').innerHTML = html;
}

function renderNdTestTypesManager() {
    var html = '<div style="padding: 15px; background: #0f1724; border-radius: 8px; border: 1px solid var(--border)">';
    
    ndTestTypes.forEach(function(type, index) {
        html += '<div class="category-item">';
        html += '<input type="text" value="' + type + '" id="ndtype_' + index + '">';
        html += '<button class="btn btn-danger btn-sm" onclick="removeNdTestType(' + index + ')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>';
        html += '</div>';
    });
    
    html += '<div class="category-item">';
    html += '<input type="text" id="new_ndtype" placeholder="–ù–æ–≤—ã–π —Ç–∏–ø —Ç–µ—Å—Ç–∞">';
    html += '<button class="btn btn-success btn-sm" onclick="addNdTestType()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>';
    html += '</div>';
    html += '<button class="btn btn-sm" onclick="saveNdTestTypes()" style="margin-top: 10px;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>';
    html += '</div>';
    
    document.getElementById('ndTestTypesManager').innerHTML = html;
}

function addNdTestType() {
    var newVal = document.getElementById('new_ndtype').value.trim();
    if (newVal) {
        ndTestTypes.push(newVal);
        document.getElementById('new_ndtype').value = '';
        renderNdTestTypesManager();
    }
}

function removeNdTestType(index) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–∏–ø —Ç–µ—Å—Ç–∞?')) {
        ndTestTypes.splice(index, 1);
        renderNdTestTypesManager();
    }
}

function saveNdTestTypes() {
    var newTypes = [];
    for (var i = 0; i < ndTestTypes.length; i++) {
        var val = document.getElementById('ndtype_' + i).value.trim();
        if (val) newTypes.push(val);
    }
    ndTestTypes = newTypes;
    saveData();
    alert('üíæ –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
}

function toggleCategoryEdit(cat) {
    var el = document.getElementById('cat_' + cat);
    el.style.display = el.style.display === 'none' ? 'block' : 'none';
}

function addSubcategory(cat) {
    var newVal = document.getElementById('new_' + cat).value.trim();
    if (newVal) {
        categories[cat][categories[cat].length - 1] = newVal;
        categories[cat].push('‚ûï –î—Ä—É–≥–æ–µ');
        document.getElementById('new_' + cat).value = '';
        renderCategoriesManager();
    }
}

function removeSubcategory(cat, index) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é?')) {
        categories[cat].splice(index, 1);
        renderCategoriesManager();
    }
}

function saveCategoryChanges(cat) {
    var newCat = [];
    for (var i = 0; i < categories[cat].length; i++) {
        if (categories[cat][i] === '‚ûï –î—Ä—É–≥–æ–µ') {
            newCat.push('‚ûï –î—Ä—É–≥–æ–µ');
            continue;
        }
        var val = document.getElementById('sub_' + cat + '_' + i).value.trim();
        if (val) newCat.push(val);
    }
    categories[cat] = newCat;
    saveData();
    populateCategories();
    alert('üíæ –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
}

// ============= –≠–ö–°–ü–û–†–¢/–ò–ú–ü–û–†–¢ =============
function doExport() {
    try {
        console.log('üìä –ù–∞—á–∏–Ω–∞—é —ç–∫—Å–ø–æ—Ä—Ç –≤ Excel...');
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ XLSX
        if (typeof XLSX === 'undefined') {
            alert('‚ùå –û–®–ò–ë–ö–ê: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ XLSX –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞:\n1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É\n2. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)\n3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞');
            console.error('XLSX –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            return;
        }
        
        console.log('‚úÖ XLSX –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–∞–π–¥–µ–Ω–∞');
        
        // ‚úÖ –ö–†–ê–°–ò–í–´–ô –î–ï–¢–ê–õ–¨–ù–´–ô –†–ï–ï–°–¢–†
        var exportData = tasks.map(function(t) {
            var statusIcon = t.status === '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' ? '‚úÖ' : 
                           t.status === '–ù–∞—á–∞—Ç–æ' ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
            
            var createdDate = t.createdAt ? new Date(t.createdAt).toLocaleString('ru-RU') : '';
            var startedDate = t.startedAt ? new Date(t.startedAt).toLocaleString('ru-RU') : '';
            var completedDate = t.completedAt ? new Date(t.completedAt).toLocaleString('ru-RU') : '';
            
            return {
                'üìÖ –î–∞—Ç–∞': t.date,
                'üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏—è': t.category,
                'üìÇ –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è': t.subcategory,
                'üìù –ù–∞–∑–≤–∞–Ω–∏–µ': t.name,
                'üë§ –ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä': t.assignedTo === 'asanbek' ? '–ê—Å–∞–Ω–±–µ–∫' : '–ê–∫—ã–ª–±–µ–∫',
                '‚è±Ô∏è –í—Ä–µ–º—è (–ß–ß:–ú–ú)': minutesToTime(t.hoursMinutes),
                'üïê –ß–∞—Å—ã (–¥–µ—Å—è—Ç–∏—á–Ω.)': minutesToDecimalHours(t.hoursMinutes),
                'üìä –°—Ç–∞—Ç—É—Å': statusIcon + ' ' + t.status,
                'üÜï –°–æ–∑–¥–∞–Ω–æ': createdDate,
                '‚ñ∂Ô∏è –ù–∞—á–∞—Ç–æ': startedDate,
                '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ': completedDate
            };
        });
        
        console.log('üìã –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π:', exportData.length);
        
        // –°–æ–∑–¥–∞–µ–º —Ä–∞–±–æ—á—É—é –∫–Ω–∏–≥—É
        var wb = XLSX.utils.book_new();
        
        // –õ–∏—Å—Ç 1: –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        var ws = XLSX.utils.json_to_sheet(exportData);
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫
        ws['!cols'] = [
            { wch: 12 },  // –î–∞—Ç–∞
            { wch: 25 },  // –ö–∞—Ç–µ–≥–æ—Ä–∏—è
            { wch: 25 },  // –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è
            { wch: 40 },  // –ù–∞–∑–≤–∞–Ω–∏–µ
            { wch: 12 },  // –ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
            { wch: 12 },  // –í—Ä–µ–º—è –ß–ß:–ú–ú
            { wch: 12 },  // –ß–∞—Å—ã –¥–µ—Å—è—Ç–∏—á–Ω.
            { wch: 15 },  // –°—Ç–∞—Ç—É—Å
            { wch: 20 },  // –°–æ–∑–¥–∞–Ω–æ
            { wch: 20 },  // –ù–∞—á–∞—Ç–æ
            { wch: 20 }   // –ó–∞–≤–µ—Ä—à–µ–Ω–æ
        ];
        
        XLSX.utils.book_append_sheet(wb, ws, '–ò–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–∏');
        
        // –õ–∏—Å—Ç 2: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        var stats = [
            { '–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å': '–í—Å–µ–≥–æ –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–µ–π', '–ó–Ω–∞—á–µ–Ω–∏–µ': tasks.length },
            { '–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å': '–í—ã–ø–æ–ª–Ω–µ–Ω–æ', '–ó–Ω–∞—á–µ–Ω–∏–µ': tasks.filter(function(t) { return t.status === '–í—ã–ø–æ–ª–Ω–µ–Ω–æ'; }).length },
            { '–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å': '–í –ø—Ä–æ—Ü–µ—Å—Å–µ', '–ó–Ω–∞—á–µ–Ω–∏–µ': tasks.filter(function(t) { return t.status === '–ù–∞—á–∞—Ç–æ'; }).length },
            { '–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å': '–û–∂–∏–¥–∞–Ω–∏–µ', '–ó–Ω–∞—á–µ–Ω–∏–µ': tasks.filter(function(t) { return t.status === '–û–∂–∏–¥–∞–Ω–∏–µ'; }).length },
            { '–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å': '–í—Å–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏', '–ó–Ω–∞—á–µ–Ω–∏–µ': minutesToTime(tasks.reduce(function(s, t) { return s + t.hoursMinutes; }, 0)) },
            { '–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å': '–ê—Å–∞–Ω–±–µ–∫ (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)', '–ó–Ω–∞—á–µ–Ω–∏–µ': tasks.filter(function(t) { return t.assignedTo === 'asanbek' && t.status === '–í—ã–ø–æ–ª–Ω–µ–Ω–æ'; }).length },
            { '–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å': '–ê–∫—ã–ª–±–µ–∫ (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)', '–ó–Ω–∞—á–µ–Ω–∏–µ': tasks.filter(function(t) { return t.assignedTo === 'akylbek' && t.status === '–í—ã–ø–æ–ª–Ω–µ–Ω–æ'; }).length }
        ];
        var wsStats = XLSX.utils.json_to_sheet(stats);
        wsStats['!cols'] = [{ wch: 25 }, { wch: 20 }];
        XLSX.utils.book_append_sheet(wb, wsStats, '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞');
        
        // –õ–∏—Å—Ç 3: –ï–ò–°–û–¢
        if (eIsotResults.length > 0) {
            var eIsotData = eIsotResults.map(function(r) {
                return {
                    '–î–∞—Ç–∞': r.date,
                    '–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä': r.instructor === 'asanbek' ? '–ê—Å–∞–Ω–±–µ–∫' : '–ê–∫—ã–ª–±–µ–∫',
                    '–°–æ—Ç—Ä—É–¥–Ω–∏–∫': r.employee,
                    '–í—Ä–µ–º—è (–º–∏–Ω)': r.time
                };
            });
            var wsEisot = XLSX.utils.json_to_sheet(eIsotData);
            XLSX.utils.book_append_sheet(wb, wsEisot, '–ï–ò–°–û–¢');
        }
        
        // –õ–∏—Å—Ç 4: –ü—Ä–æ–º–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
        if (prombezResults.length > 0) {
            var prombezData = prombezResults.map(function(r) {
                return {
                    '–î–∞—Ç–∞': r.date,
                    '–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä': r.instructor === 'asanbek' ? '–ê—Å–∞–Ω–±–µ–∫' : '–ê–∫—ã–ª–±–µ–∫',
                    '–û–ø–∏—Å–∞–Ω–∏–µ': r.description
                };
            });
            var wsPrombez = XLSX.utils.json_to_sheet(prombezData);
            XLSX.utils.book_append_sheet(wb, wsPrombez, '–ü—Ä–æ–º–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å');
        }
        
        // –õ–∏—Å—Ç 5: –ù–î —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        if (ndTestingResults.length > 0) {
            var ndData = ndTestingResults.map(function(r) {
                return {
                    '–î–∞—Ç–∞': r.date,
                    '–¢–∏–ø': r.type,
                    '–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä': r.instructor === 'asanbek' ? '–ê—Å–∞–Ω–±–µ–∫' : '–ê–∫—ã–ª–±–µ–∫',
                    '–û–ø–∏—Å–∞–Ω–∏–µ': r.description
                };
            });
            var wsNd = XLSX.utils.json_to_sheet(ndData);
            XLSX.utils.book_append_sheet(wb, wsNd, '–ù–î —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ');
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        var filename = '–†–µ–µ—Å—Ç—Ä_–ò–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–µ–π_' + new Date().toISOString().split('T')[0] + '.xlsx';
        XLSX.writeFile(wb, filename);
        
        console.log('‚úÖ –§–∞–π–ª —Å–æ–∑–¥–∞–Ω:', filename);
        addToFullHistory('üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel: ' + tasks.length + ' –∑–∞–ø–∏—Å–µ–π');
        alert('‚úÖ –≠–ö–°–ü–û–†–¢ –í–´–ü–û–õ–ù–ï–ù!\n\n–§–∞–π–ª: ' + filename + '\n\n–õ–∏—Å—Ç—ã:\n‚Ä¢ –ò–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–∏ (' + tasks.length + ')\n‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n‚Ä¢ –ï–ò–°–û–¢ (' + eIsotResults.length + ')\n‚Ä¢ –ü—Ä–æ–º–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (' + prombezResults.length + ')\n‚Ä¢ –ù–î —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (' + ndTestingResults.length + ')');
        
    } catch(error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
        alert('‚ùå –û–®–ò–ë–ö–ê –≠–ö–°–ü–û–†–¢–ê!\n\n' + error.message + '\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:\n1. –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\n2. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)\n3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞');
    }
}

function doExportJSON() {
    try {
        var data = {
            tasks: tasks,
            eIsot: eIsotResults,
            prombez: prombezResults,
            nd: ndTestingResults,
            history: fullHistory,
            categories: categories,
            ndTestTypes: ndTestTypes,
            exportDate: new Date().toISOString()
        };
        var json = JSON.stringify(data, null, 2);
        var blob = new Blob([json], { type: 'application/json' });
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = 'backup_' + new Date().toISOString().split('T')[0] + '.json';
        a.click();
        URL.revokeObjectURL(url);
        addToFullHistory('üíæ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON');
        alert('‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω!');
    } catch(error) {
        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ JSON: ' + error.message);
    }
}

function importFromFile() {
    var file = document.getElementById('importFile').files[0];
    if (!file) {
        alert('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª');
        return;
    }
    
    var reader = new FileReader();
    reader.onload = function(e) {
        try {
            var data = JSON.parse(e.target.result);
            tasks = data.tasks || [];
            eIsotResults = data.eIsot || [];
            prombezResults = data.prombez || [];
            ndTestingResults = data.nd || [];
            fullHistory = data.history || [];
            categories = data.categories || categories;
            ndTestTypes = data.ndTestTypes || ndTestTypes;
            saveData();
            populateCategories();
            showTasks();
            updateStats();
            alert('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
            addToFullHistory('üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö');
        } catch(e) {
            alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö: ' + e.message);
            console.error(e);
        }
    };
    reader.readAsText(file);
}

function clearAllData() {
    if (confirm('‚ö†Ô∏è –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ! –í—ã —É–≤–µ—Ä–µ–Ω—ã?')) {
        if (confirm('‚ùó –ü–û–°–õ–ï–î–ù–ï–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï! –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ!')) {
            localStorage.clear();
            alert('üóëÔ∏è –í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã');
            setTimeout(function() {
                location.reload();
            }, 1000);
        }
    }
}

// ============= –í–ö–õ–ê–î–ö–ò =============
function openTab(evt, tabName) {
    var tabs = document.getElementsByClassName('tab-content');
    for (var i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove('active');
    }
    var btns = document.getElementsByClassName('tab-btn');
    for (var i = 0; i < btns.length; i++) {
        btns[i].classList.remove('active');
    }
    document.getElementById(tabName).classList.add('active');
    evt.currentTarget.classList.add('active');
    
    if (tabName === 'testing') {
        renderEIsot();
        renderPrombez();
        renderNDTesting();
    }
    if (tabName === 'analytics') renderAnalytics();
    if (tabName === 'dashboard') renderDashboard();
    if (tabName === 'history') renderHistory();
    if (tabName === 'settings') {
        renderMainCategoriesManager();
        renderCategoriesManager();
        renderNdTestTypesManager();
    }
}

// ============= –ó–ê–ö–†–´–¢–ò–ï –ú–û–î–ê–õ–¨–ù–´–• –û–ö–û–ù =============
window.addEventListener('click', function(e) {
    if (e.target.classList.contains('modal')) {
        e.target.classList.remove('show');
    }
});

// ============= GOOGLE SHEETS –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø =============
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwKkFf3qq_0s-Um-UvDpXH-IEL229RkDbQ8J68CKoyW3ZW6HpKn-3Hp5C3LX79WbgG-MQ/exec';

async function syncToCloud() {
    try {
        const dataToSync = {
            data: JSON.stringify({
                tasks: tasks,
                eIsotResults: eIsotResults,
                prombezResults: prombezResults,
                ndTestingResults: ndTestingResults,
                fullHistory: fullHistory,
                categories: categories,
                ndTestTypes: ndTestTypes,
                lastSync: new Date().toISOString(),
                syncedBy: currentUser
            }),
            user: currentUser
        };
        
        const response = await fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(dataToSync)
        });
        
        const result = await response.json();
        if (result.status === "success") {
            alert('‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ!\n\n–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ Google Sheets');
            addToFullHistory('‚òÅÔ∏è –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –≤ Google Sheets');
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞: ' + result.message);
        }
    } catch (error) {
        alert('‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: ' + error.message);
    }
}

async function syncFromCloud() {
    try {
        const response = await fetch(GOOGLE_SCRIPT_URL + '?action=get');
        const result = await response.json();
        
        if (result.status === "success" && result.data) {
            const restoredData = JSON.parse(result.data);
            
            tasks = restoredData.tasks || [];
            eIsotResults = restoredData.eIsotResults || [];
            prombezResults = restoredData.prombezResults || [];
            ndTestingResults = restoredData.ndTestingResults || [];
            fullHistory = restoredData.fullHistory || [];
            categories = restoredData.categories || categories;
            ndTestTypes = restoredData.ndTestTypes || ndTestTypes;
            
            saveData();
            showTasks();
            updateStats();
            
            alert('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!\n\n–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ Google Sheets');
            addToFullHistory('‚òÅÔ∏è –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ Google Sheets');
        } else {
            alert('üì≠ –í –æ–±–ª–∞–∫–µ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö');
        }
    } catch (error) {
        alert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message);
    }
}

// ============= –ó–ê–ü–£–°–ö =============
init();
</script>

</body>
</html>
